<!DOCTYPE html>
<html>
<head>
	<title>Test JS: touch events</title>
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge">

	<script src="https://romanlaptev.github.io/js/shared_functions.js"></script>
	<link rel="stylesheet" href="https://romanlaptev.github.io/css/lr.css">

	<script src="lib/shared_functions.js"></script>
	<link rel="stylesheet" href="../css/lr.css">



<script>
	var func = sharedFunc();
//console.log("func:", func);

	var _testObj = {
		"logMsg": "",
		"support": func.testSupport()
	};
//console.log( _testObj );

	var touchOffsetX, touchOffsetY;

	document.addEventListener("DOMContentLoaded", function(e){

		for(key in _testObj["support"]){
			_testObj.logMsg = key + ": "+_testObj["support"][key];
			//func.logAlert( _testObj.logMsg, "info");
		}//next

		_testObj.logMsg = navigator.userAgent;
		func.logAlert( _testObj.logMsg, "info");

		_testObj.logMsg = "supportTouch: "+_testObj["support"]["supportTouch"];
		func.logAlert( _testObj.logMsg, "info");

		//init test object
		_testObj["log"] = func.getById("log");
		_testObj["testBox"] = func.getById("test-box");
		_testObj["testArea"] = document.querySelector("#test-area");

		//_testObj["btn_clear_log"] = document.querySelector("#btn-clear-log");
		_testObj["btn_clear_log"] = func.getById("btn-clear-log");
		_testObj["btn_clear_log"].onclick = function( event ){
//alert("click...");
				event = event || window.event;
				var target = event.target || event.srcElement;
				if (event.preventDefault) {
					event.preventDefault();
				} else {
					event.returnValue = false;
				}
				_testObj.log.innerHTML = "";
				//_testObj.log.classList.add("hide");

		};//end event
		//_testObj["btn_clear_log"].addEventListener("click", function(e){
//console.log("click...", event);
		//}, false);//end event

		_testObj["btn_toggle_log"] = func.getById("btn-toggle-log");
		_testObj["btn_toggle_log"].onclick = function( event ){
			event = event || window.event;
			var target = event.target || event.srcElement;
			if (event.preventDefault) {
				event.preventDefault();
			} else {
				event.returnValue = false;
			}

			if( _testObj.log.style.display==="none"){
				_testObj.log.style.display="block";
				_testObj["btn_toggle_log"].innerHTML="-";
			} else {
				_testObj.log.style.display="none";
				_testObj["btn_toggle_log"].innerHTML="+";
			}

			//if( _testObj["log"].classList.contains("d-none") ){
				//_testObj["log"].classList.remove("d-none");
				//_testObj["log"].classList.add("d-block");
				//return;
			//}
			//if( _testObj["log"].classList.contains("d-block") ){
				//_testObj["log"].classList.remove("d-block");
				//_testObj["log"].classList.add("d-none");
				//return;
			//}
			//_testObj["log"].classList.add("d-none");

		};//end event

		if( _testObj["support"]["supportTouch"] ){
			startup();
		}

	}, false);//end load


function startup() {
	//document.addEventListener("touchstart", handleStart, false);
	//document.addEventListener("touchend", handleEnd, false);
	//document.addEventListener("touchcancel", handleCancel, false);
	//document.addEventListener("touchmove", handleMove, false);

	_testObj["testArea"].addEventListener("touchstart", handleStart, false);
	_testObj["testArea"].addEventListener("touchend", handleEnd, false);
	_testObj["testArea"].addEventListener("touchmove", handleMove, false);
	_testObj["testArea"].addEventListener("touchcancel", handleCancel, false);
}

function handleStart(e) {
	//e.preventDefault();
	_testObj.logMsg = "event type: " + e.type;

	if (e.targetTouches.length == 1) {
		var touch=e.targetTouches[0];
		touchOffsetX = touch.pageX - touch.target.offsetLeft;
		touchOffsetY = touch.pageY - touch.target.offsetTop;

		_testObj["testBox"].style.left = touchOffsetX+"px";
		_testObj["testBox"].style.top = touchOffsetY+"px";

		_testObj.logMsg += ", pageX: " + touch.pageX;
		_testObj.logMsg += ", pageY: " + touch.pageY;
		_testObj.logMsg += ", touchOffsetX: " + touch.pageX +" - " +touch.target.offsetLeft+" = "+touchOffsetX;
		_testObj.logMsg += ", touchOffsetY: " + touch.pageY +" - " +touch.target.offsetTop+" =" + touchOffsetY;
	}

	func.logAlert( _testObj.logMsg, "info");

	//for( var key in e.targetTouches[0]){
		//$("#log")[0].innerHTML += "<p>"+logMsg +"</p>";
		//logMsg = key +", " + e.targetTouches[0][key];
	//}

/*
	var touches = e.changedTouches;//массив активных точек касаний
	for( var key in touches[0]){
		logMsg = key +", " + touches[0][key];
		$("#log")[0].innerHTML += "<p>"+logMsg +"</p>";
	}
*/
	//for (var n = 0; n < touches.length; n++) {
		//logMsg = "changedTouches:" + n + "...";
		//$("#log")[0].innerHTML += "<p>"+logMsg +"</p>";
	//}//next
}//end event

function handleEnd(e) {
	//e.preventDefault();
	_testObj.logMsg = "event type: " + e.type;
	_testObj.logMsg += ", screenX: " + e.changedTouches[0]["screenX"];
	_testObj.logMsg += ", screenY: " + e.changedTouches[0]["screenY"];
	func.logAlert( _testObj.logMsg, "info");
}//end event

function handleMove(e) {
	//e.preventDefault();

	_testObj.logMsg = "event type: " + e.type;
	//logMsg += ", screenX: " + e.changedTouches[0]["screenX"];
	//logMsg += ", screenY: " + e.changedTouches[0]["screenY"];

	if (e.targetTouches.length == 1) {
		var touch=e.targetTouches[0];
		touchOffsetX = touch.pageX - touch.target.offsetLeft;
		touchOffsetY = touch.pageY - touch.target.offsetTop;

		_testObj["testBox"].style.left = touchOffsetX+"px";
		_testObj["testBox"].style.top = touchOffsetY+"px";

		//_testObj.logMsg += ", pageX: " + touch.pageX;
		//_testObj.logMsg += ", pageY: " + touch.pageY;
		//_testObj.logMsg += ", touchOffsetX: " + touch.pageX +" - " +touch.target.offsetLeft+" = "+touchOffsetX;
		//_testObj.logMsg += ", touchOffsetY: " + touch.pageY +" - " +touch.target.offsetTop+" =" + touchOffsetY;
	}

	//func.logAlert( _testObj.logMsg, "info");
}//end event

function handleCancel(e) {
	//e.preventDefault();

	_testObj.logMsg = "event type: " + e.type;
	func.logAlert( _testObj.logMsg, "info");

	for( var key in e){
	_testObj["log"].innerHTML += "<p>"+logMsg +"</p>";
		logMsg = key +", " + e[key];
	}

}//end event

</script>

<style>
.border-box{
	border-width: 2px;
	border-style: dashed;
	border-color: red;
	text-align:center;
	padding:20px;
}
/*@media (max-width:400px){*/
	.log-panel {
		bottom: auto;
		top: 0px;
		left:0;
	}
	.log-panel .btn-group {
		position: fixed;
		top: 0;
		left: 0;
	}

	#log {
		position: relative;
		top: 45px;
	}

/*}*/
</style>

</head>

<body class="bg-darkblue-sea">

<div class="lr-container w80 mt20 color-white">
	<h1 class="m0">Test JS: touch events</h1>
<p>touchstart, touchmove, touchend, touchcancel</p>
</div>

<div class="lr-container w80 p20 bg-grey-green lr-border-round">

	<div class="log-panel panel">
		<div id="log" class=""></div>
		<div class="btn-group">
			<a id="btn-toggle-log" href="#" title="Toggle log" class="lr-btn lr-btn-default">-</a>
			<a id="btn-clear-log" href="#" title="Clear log" class="lr-btn lr-btn-default">x</a>
		</div>
	</div>


	<div id="test-area" class="p20 p20 h400px w80 bg-lavender">test-area
		<div id="test-box" class="border-box pos-center-rel w100px h100px bg-white">touch me....</div>
	</div>

	<pre class="bg-yellow-pre p10">
https://www.w3.org/TR/touch-events/
https://www.w3schools.com/jsref/event_touchstart.asp

https://developer.mozilla.org/ru/docs/Web/API/Touch_events
Тач-события

https://habr.com/ru/company/sibirix/blog/227175/
Заставьте сайт работать на сенсорных устройствах

https://youon.ru/%D0%90%D0%BD%D0%B4%D1%80%D0%BE%D0%B8%D0%B4/%D0%A0%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0/touch-sobytiya-na-javascript-multitach-realizatsiya
Touch события на javascript, мультитач - реализация

https://habr.com/ru/company/mailru/blog/165213/
Touch-web: Swipe
	</pre>

</div>
<!-- end container -->

</body>
</html>
