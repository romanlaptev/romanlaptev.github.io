<!DOCTYPE html>
<html>
<head>
	<title>Test JS: touch events</title>
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge">

	<script src="lib/shared_functions.js"></script>
	<link rel="stylesheet" href="../css/lr.css">

	<script src="http://romanlaptev.github.io/js/shared_functions.js"></script>
	<link rel="stylesheet" href="http://romanlaptev.github.io/css/lr.css">


<script>
	var func = sharedFunc();
console.log("func:", func);

	var _testObj = {
		"logMsg": "",
		"support": func.testSupport()
	};
console.log( _testObj );

	var touchOffsetX, touchOffsetY;

	document.addEventListener("DOMContentLoaded", function(e){


		for(key in _testObj["support"]){
			_testObj.logMsg = key + ": "+_testObj["support"][key];
			//func.logAlert( _testObj.logMsg, "info");
		}//next

		_testObj.logMsg = navigator.userAgent;
		func.logAlert( _testObj.logMsg, "info");

		_testObj.logMsg = "supportTouch: "+_testObj["support"]["supportTouch"];
		func.logAlert( _testObj.logMsg, "info");

		//init test object
		_testObj["log"] = func.getById("log");
		_testObj["btn_clear_log"] = func.getById("btn-clear-log");

		_testObj["btn_clear_log"].onclick = function( event ){
//console.log("click...", e);
			event = event || window.event;
			var target = event.target || event.srcElement;
			if (event.preventDefault) {
				event.preventDefault();
			} else {
				event.returnValue = false;
			}
			_testObj.log.innerHTML = "";
			//_testObj.log.classList.add("hide");
		};//end event

		if( _testObj["support"]["supportTouch"] ){
			startup();
		}

	});//end load


/*

	//touchstart, touchmove, touchend и touchcancel

	$(document).ready(function(){
		logMsg = "userAgent:" +navigator.userAgent +"<br>";
		logMsg += 'jQuery version: ' + jQuery.fn.jquery +"<br>";
		$("#log")[0].innerHTML += "<p class='alert alert-info'>"+logMsg +"</p>";

		logMsg = "Touch Events support: " +touchSupport;
		$("#log")[0].innerHTML += "<p class='alert alert-info'>"+logMsg +"</p>";

		$("#btn-clear-log").on("click",function(e){
			e.preventDefault();
			$("#log")[0].innerHTML = "";
		});//end event();

	});//end ready
*/

function startup() {
	//document.addEventListener("touchstart", handleStart, false);
	//document.addEventListener("touchend", handleEnd, false);
	//document.addEventListener("touchcancel", handleCancel, false);
	//document.addEventListener("touchmove", handleMove, false);

	var area = document.querySelector("#test-area");
	area.addEventListener("touchstart", handleStart, false);
	area.addEventListener("touchend", handleEnd, false);
	area.addEventListener("touchmove", handleMove, false);
	area.addEventListener("touchcancel", handleCancel, false);

	//$("#test-area").on("touchstart", function(e){
		//handleStart(e);
	//});
}

function handleStart(e) {
	e.preventDefault();
	logMsg = "event type: " + e.type;

	if (e.targetTouches.length == 1) {
		var touch=e.targetTouches[0];
		touchOffsetX = touch.pageX - touch.target.offsetLeft;
		touchOffsetY = touch.pageY - touch.target.offsetTop;

		$("#box").css("left", touchOffsetX+"px");
		$("#box").css("top", touchOffsetY+"px");

		logMsg += ", pageX: " + touch.pageX;
		logMsg += ", pageY: " + touch.pageY;
		logMsg += ", touchOffsetX: " + touch.pageX +" - " +touch.target.offsetLeft+" = "+touchOffsetX;
		logMsg += ", touchOffsetY: " + touch.pageY +" - " +touch.target.offsetTop+" =" + touchOffsetY;
	}

	$("#log")[0].innerHTML += "<p>"+logMsg +"</p>";

	//for( var key in e.targetTouches[0]){
		//$("#log")[0].innerHTML += "<p>"+logMsg +"</p>";
		//logMsg = key +", " + e.targetTouches[0][key];
	//}

/*
	var touches = e.changedTouches;//массив активных точек касаний
	for( var key in touches[0]){
		logMsg = key +", " + touches[0][key];
		$("#log")[0].innerHTML += "<p>"+logMsg +"</p>";
	}
*/
	//for (var n = 0; n < touches.length; n++) {
		//logMsg = "changedTouches:" + n + "...";
		//$("#log")[0].innerHTML += "<p>"+logMsg +"</p>";
	//}//next
}//end event

function handleEnd(e) {
	e.preventDefault();

	logMsg = "event type: " + e.type;
	logMsg += ", screenX: " + e.changedTouches[0]["screenX"];
	logMsg += ", screenY: " + e.changedTouches[0]["screenY"];
	$("#log")[0].innerHTML += "<p>"+logMsg +"</p>";

}//end event

function handleMove(e) {
	e.preventDefault();

	logMsg = "event type: " + e.type;
	//logMsg += ", screenX: " + e.changedTouches[0]["screenX"];
	//logMsg += ", screenY: " + e.changedTouches[0]["screenY"];
/*
	logMsg += ", touchOffsetX: " + touchOffsetX;
	logMsg += ", touchOffsetY: " + touchOffsetY;
	$("#log")[0].innerHTML += "<p>"+logMsg +"</p>";

	if (e.targetTouches.length == 1) {
		var touch = e.targetTouches[0];
		$("#box").css("left", touch.pageX-touchOffsetX+"px");
		$("#box").css("top", touch.pageY-touchOffsetY+"px");
	}
*/
}//end event

function handleCancel(e) {
	e.preventDefault();

	logMsg = "event type: " + e.type;
	$("#log")[0].innerHTML += "<p>"+logMsg +"</p>";

	for( var key in e){
		$("#log")[0].innerHTML += "<p>"+logMsg +"</p>";
		logMsg = key +", " + e[key];
	}

}//end event

</script>

<style>
.border-box{
	border-width: 2px;
	border-style: dashed;
	border-color: red;
	text-align:center;
	padding:20px;
}
#log.hide{
	height:0;
}
</style>

</head>

<body class="bg-darkblue-sea">

<div class="lr-container w80 mt20 color-white">
	<h1 class="m0">Test JS: touch events</h1>
</div>

<div class="lr-container w80 p20 bg-grey-green lr-border-round">

	<div class="log-panel panel">
		<div id="log" class=""></div>
		<div class="float-right">
			<a title="Clear log" id="btn-clear-log" class="lr-btn lr-btn-default">x</a>
		</div>
	</div>


	<div id="test-area" class="p20 p20 h400px">
		<div class="border-box w100px h100px bg-white">touch me....</div>
	</div>

	<pre class="bg-yellow-pre p10">
https://www.w3.org/TR/touch-events/
https://www.w3schools.com/jsref/event_touchstart.asp

https://developer.mozilla.org/ru/docs/Web/API/Touch_events
Тач-события

https://habr.com/ru/company/sibirix/blog/227175/
Заставьте сайт работать на сенсорных устройствах

https://youon.ru/%D0%90%D0%BD%D0%B4%D1%80%D0%BE%D0%B8%D0%B4/%D0%A0%D0%B0%D0%B7%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%BA%D0%B0/touch-sobytiya-na-javascript-multitach-realizatsiya
Touch события на javascript, мультитач - реализация

https://habr.com/ru/company/mailru/blog/165213/
Touch-web: Swipe
	</pre>

</div>
<!-- end container -->

</body>
</html>
