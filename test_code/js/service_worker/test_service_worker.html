<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="utf8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="../../../css/bootstrap335.min.css">
<style>
	#info {  border: 1px dashed;  padding: 10px; }
</style>
	<script src="../lib/shared_functions.js"></script>
</head>
<body class="bg-primary">
	<div class="container">

		<div class="page-header">
			<h1>test Service Worker</h1>
		</div>
		
		<pre>
https://caniuse.com/#search=Service%20Workers
		
https://developer.mozilla.org/ru/docs/Web/API/Service_Worker_API/Using_Service_Workers
https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API#Interfaces
https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage

http://prgssr.ru/development/sozdaem-service-worker.html
Пошаговое руководство по созданию сервис-воркера для офлайн-версии сайта. Перевод статьи Лизы Денжер Гарднер.

https://css-tricks.com/serviceworker-for-offline/
https://mobiforge.com/design-development/taking-web-offline-service-workers
		</pre>
		
		<div class="panel">
			<div class="panel-body" id="log"></div>
		</div>
		
	</div><!-- end container -->
	
<script>
	var func = sharedFunc();
//console.log("func:", func);
	var logMsg;
	
	var test =  typeof window.Promise !== "undefined";
	logMsg = "Promise support:" + test;
	if( test ){
		func.logAlert(logMsg, "success");
	} else {
		func.logAlert(logMsg, "error");
	}
	
	test = 'serviceWorker' in navigator;
	logMsg = "serviceWorker support: " + test;
	if( test ){
		func.logAlert(logMsg, "success");
	} else {
		func.logAlert(logMsg, "error");
	}

	if( window.location.protocol !== "https:"){
		logMsg = "error,  serviceWorker requires 'https:' protocol....";
		logMsg += "but used: " + window.location.protocol;
		func.logAlert(logMsg, "error");
	}
	
	if ("serviceWorker" in navigator) {
		logMsg = "CLIENT: service worker registration in progress.";
		func.logAlert(logMsg, "info");
		
		navigator.serviceWorker.register("sw.js")
		.then(function(reg) {
			logMsg = "Registration succeeded. Scope is " + reg.scope;
			func.logAlert(logMsg, "success");
			
			if(reg.installing) {
				func.log('Service worker installing');
			} else 
				if(reg.waiting) {
					func.log('Service worker installed');
				} else 
					if(reg.active) {
						func.log('Service worker active');
				}
		
	  }).catch(function(error) {
		logMsg = "Registration failed."
		func.logAlert(logMsg, "error");
console.log(error);
	  });
		
	} else {
		logMsg = "CLIENT: service worker is not supported."
		func.logAlert(logMsg, "error");
	}

</script>

</body>
</html>